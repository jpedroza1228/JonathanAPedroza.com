{
  "hash": "69241e85daedb015a90161190aefa748",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Bayesian Network for US Coffee Tasting Data Using R & Stan\" \nsubtitle: |\n  Estimation\nimage: /posts/2024-11-03-bayes-net-us-coffee-tasting/pourover.jpg\ncategories: [Bayesian, Bayesian Network, bayes net, R, rstan, cmdstanr, posterior, bayesplot, dag]\ndate: 2024-11-03\n# citation:\n  # url: \nparams:\n  slug: Bayes-Net-Bnlearn-Coffee-Tasting\n  date: 2024-11-03\n---\n\n::: {.cell}\n\n```{.r .cell-code}\nlibrary(tidyverse)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──\n✔ dplyr     1.1.4     ✔ readr     2.1.5\n✔ forcats   1.0.0     ✔ stringr   1.5.1\n✔ ggplot2   3.5.1     ✔ tibble    3.2.1\n✔ lubridate 1.9.3     ✔ tidyr     1.3.1\n✔ purrr     1.0.2     \n── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──\n✖ dplyr::filter() masks stats::filter()\n✖ dplyr::lag()    masks stats::lag()\nℹ Use the conflicted package (<http://conflicted.r-lib.org/>) to force all conflicts to become errors\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(inspectdf)\nlibrary(bnlearn)\nlibrary(Rgraphviz)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nLoading required package: graph\nLoading required package: BiocGenerics\n\nAttaching package: 'BiocGenerics'\n\nThe following object is masked from 'package:bnlearn':\n\n    score\n\nThe following objects are masked from 'package:lubridate':\n\n    intersect, setdiff, union\n\nThe following objects are masked from 'package:dplyr':\n\n    combine, intersect, setdiff, union\n\nThe following objects are masked from 'package:stats':\n\n    IQR, mad, sd, var, xtabs\n\nThe following objects are masked from 'package:base':\n\n    anyDuplicated, aperm, append, as.data.frame, basename, cbind,\n    colnames, dirname, do.call, duplicated, eval, evalq, Filter, Find,\n    get, grep, grepl, intersect, is.unsorted, lapply, Map, mapply,\n    match, mget, order, paste, pmax, pmax.int, pmin, pmin.int,\n    Position, rank, rbind, Reduce, rownames, sapply, setdiff, table,\n    tapply, union, unique, unsplit, which.max, which.min\n\n\nAttaching package: 'graph'\n\nThe following objects are masked from 'package:bnlearn':\n\n    degree, nodes, nodes<-\n\nThe following object is masked from 'package:stringr':\n\n    boundary\n\nLoading required package: grid\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(reactable)\nlibrary(ggdag)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'ggdag'\n\nThe following object is masked from 'package:stats':\n\n    filter\n```\n\n\n:::\n\n```{.r .cell-code}\nlibrary(dagitty)\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\n\nAttaching package: 'dagitty'\n\nThe following object is masked from 'package:Rgraphviz':\n\n    graphLayout\n\nThe following object is masked from 'package:graph':\n\n    edges\n\nThe following objects are masked from 'package:bnlearn':\n\n    ancestors, children, descendants, parents, spouses\n```\n\n\n:::\n\n```{.r .cell-code}\nbn_score <- bnlearn::score\n\ntheme_set(theme_light())\n\ncoffee <- read_csv(here::here(\"posts/2024-11-03-bayes-net-us-coffee-tasting\", \"hoffmann_america_taste_data.csv\")) |>\n  janitor::clean_names()\n```\n\n::: {.cell-output .cell-output-stderr}\n\n```\nRows: 4042 Columns: 113\n── Column specification ────────────────────────────────────────────────────────\nDelimiter: \",\"\nchr (44): Submission ID, What is your age?, How many cups of coffee do you t...\ndbl (13): Lastly, how would you rate your own coffee expertise?, Coffee A - ...\nlgl (56): Where do you typically drink coffee? (At home), Where do you typic...\n\nℹ Use `spec()` to retrieve the full column specification for this data.\nℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncoffee_drop <- coffee[, which(colMeans(!is.na(coffee)) > 0.5)]\n\ncoffee_drop |>\n  inspect_na() |>\n  show_plot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncoffee_drop <- coffee_drop |>\n  select(\n    -c(\n      where_do_you_typically_drink_coffee,\n      # how_do_you_brew_coffee_at_home,\n      do_you_usually_add_anything_to_your_coffee,\n      why_do_you_drink_coffee\n    )\n  ) |>\n  rename(\n    age = what_is_your_age,\n    cup_per_day = how_many_cups_of_coffee_do_you_typically_drink_per_day,\n    drink_at_home = where_do_you_typically_drink_coffee_at_home,\n    drink_at_office = where_do_you_typically_drink_coffee_at_the_office,\n    drink_on_go = where_do_you_typically_drink_coffee_on_the_go,\n    drink_at_cafe = where_do_you_typically_drink_coffee_at_a_cafe,\n    drink_none_of_these = where_do_you_typically_drink_coffee_none_of_these,\n    home_brew_pour_over = how_do_you_brew_coffee_at_home_pour_over,\n    home_brew_french_press = how_do_you_brew_coffee_at_home_french_press,\n    home_brew_espresso = how_do_you_brew_coffee_at_home_espresso,\n    home_brew_mr_coffee = how_do_you_brew_coffee_at_home_coffee_brewing_machine_e_g_mr_coffee,\n    home_brew_pods = how_do_you_brew_coffee_at_home_pod_capsule_machine_e_g_keurig_nespresso,\n    home_brew_instant = how_do_you_brew_coffee_at_home_instant_coffee,\n    home_brew_bean2cup = how_do_you_brew_coffee_at_home_bean_to_cup_machine,\n    home_brew_cold_brew = how_do_you_brew_coffee_at_home_cold_brew,\n    home_brew_cometeer = how_do_you_brew_coffee_at_home_coffee_extract_e_g_cometeer,\n    home_brew_other = how_do_you_brew_coffee_at_home_other,\n    favorite_coffee_drink = what_is_your_favorite_coffee_drink,\n    coffee_black = do_you_usually_add_anything_to_your_coffee_no_just_black,\n    coffee_milk_alt_creamer = do_you_usually_add_anything_to_your_coffee_milk_dairy_alternative_or_coffee_creamer,\n    coffee_sugar = do_you_usually_add_anything_to_your_coffee_sugar_or_sweetener,\n    coffee_syrup = do_you_usually_add_anything_to_your_coffee_flavor_syrup,\n    coffee_other = do_you_usually_add_anything_to_your_coffee_other,\n    coffee_characteristic_preference = before_todays_tasting_which_of_the_following_best_described_what_kind_of_coffee_you_like,\n    coffee_strength = how_strong_do_you_like_your_coffee,\n    roast_preference = what_roast_level_of_coffee_do_you_prefer,\n    caffeine_preference = how_much_caffeine_do_you_like_in_your_coffee,\n    expertise = lastly_how_would_you_rate_your_own_coffee_expertise,\n    preference_a_to_b = between_coffee_a_coffee_b_and_coffee_c_which_did_you_prefer,\n    preference_a_to_d = between_coffee_a_and_coffee_d_which_did_you_prefer,\n    favorite_abcd = lastly_what_was_your_favorite_overall_coffee,\n    remote_work = do_you_work_from_home_or_in_person,\n    money_spend_a_month = in_total_much_money_do_you_typically_spend_on_coffee_in_a_month,\n    why_drink_taste_good = why_do_you_drink_coffee_it_tastes_good,\n    why_drink_caffeine = why_do_you_drink_coffee_i_need_the_caffeine,\n    why_drink_ritual = why_do_you_drink_coffee_i_need_the_ritual,\n    why_drink_makes_bathroom = why_do_you_drink_coffee_it_makes_me_go_to_the_bathroom,\n    why_drink_other = why_do_you_drink_coffee_other,\n    like_taste = do_you_like_the_taste_of_coffee,\n    know_where_coffee_comes_from = do_you_know_where_your_coffee_comes_from,\n    most_spent_on_cup_coffee = what_is_the_most_youve_ever_paid_for_a_cup_of_coffee,\n    willing_to_spend_cup_coffee = what_is_the_most_youd_ever_be_willing_to_pay_for_a_cup_of_coffee,\n    good_value_cafe = do_you_feel_like_you_re_getting_good_value_for_your_money_when_you_buy_coffee_at_a_cafe,\n    equipment_spent_5years = approximately_how_much_have_you_spent_on_coffee_equipment_in_the_past_5_years,\n    good_value_equipment = do_you_feel_like_you_re_getting_good_value_for_your_money_with_regards_to_your_coffee_equipment\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\ncoffee_logical <- coffee_drop |>\n  select_if(is.logical)\n\ncoffee_drop <- coffee_drop |>\n  drop_na(\n    colnames(coffee_logical)\n  )\n\ncoffee_drop <- coffee_drop |>\n  mutate(\n    across(\n      where(\n        is.logical\n      ),\n      ~case_when(\n        .x == TRUE ~ 1,\n        .x == FALSE ~ 0\n      )\n    ),\n    across(\n      where(\n        is.character\n      ),\n      ~as.factor(.x)\n    )\n  )\n\ncoffee_drop <- coffee_drop |>\n  select(\n    -matches(\n      \"_notes\"\n    )\n  )\n\ncoffee_drop |>\n  inspect_na() |>\n  show_plot()\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\n# Variables Chosen For Modeling & Dropping NAs\n\n\n::: {.cell}\n\n```{.r .cell-code}\npurrr::map2(\n  coffee_drop |>\n  select(\n    gender,\n    age,\n    cup_per_day,\n    favorite_coffee_drink,\n    home_brew_pour_over,\n    home_brew_french_press,\n    home_brew_espresso,\n    home_brew_mr_coffee,\n    home_brew_pods,\n    home_brew_instant,\n    home_brew_bean2cup,\n    home_brew_cold_brew,\n    home_brew_cometeer,\n    home_brew_other,\n    roast_preference,\n    expertise,\n    favorite_abcd\n  ) |> \n  drop_na(),\n  names(coffee_drop |>\n  select(\n    gender,\n    age,\n    cup_per_day,\n    favorite_coffee_drink,\n    home_brew_pour_over,\n    home_brew_french_press,\n    home_brew_espresso,\n    home_brew_mr_coffee,\n    home_brew_pods,\n    home_brew_instant,\n    home_brew_bean2cup,\n    home_brew_cold_brew,\n    home_brew_cometeer,\n    home_brew_other,\n    roast_preference,\n    expertise,\n    favorite_abcd\n  ) |> \n  drop_na()\n  ),\n  ~ggplot(\n    coffee_drop |>\n  select(\n    gender,\n    age,\n    cup_per_day,\n    favorite_coffee_drink,\n    home_brew_pour_over,\n    home_brew_french_press,\n    home_brew_espresso,\n    home_brew_mr_coffee,\n    home_brew_pods,\n    home_brew_instant,\n    home_brew_bean2cup,\n    home_brew_cold_brew,\n    home_brew_cometeer,\n    home_brew_other,\n    roast_preference,\n    expertise,\n    favorite_abcd\n  ) |> \n  drop_na(),\n  aes(.x)\n  ) + \n  geom_bar(\n    fill = \"dodgerblue\"\n  ) +\n  coord_flip() +\n  labs(\n    title = glue::glue(\"{.y}\")\n  )\n)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n$gender\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n$age\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n$cup_per_day\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-3.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n$favorite_coffee_drink\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-4.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n$home_brew_pour_over\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-5.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n$home_brew_french_press\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-6.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n$home_brew_espresso\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-7.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n$home_brew_mr_coffee\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-8.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n$home_brew_pods\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-9.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n$home_brew_instant\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-10.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n$home_brew_bean2cup\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-11.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n$home_brew_cold_brew\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-12.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n$home_brew_cometeer\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-13.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n$home_brew_other\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-14.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n$roast_preference\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-15.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n$expertise\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-16.png){width=672}\n:::\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\n$favorite_abcd\n```\n\n\n:::\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-17.png){width=672}\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnona <- \n  coffee_drop |>\n  select(\n    submission_id,\n    gender,\n    age,\n    cup_per_day,\n    home_brew_pour_over,\n    home_brew_french_press,\n    home_brew_espresso,\n    home_brew_mr_coffee,\n    home_brew_pods,\n    home_brew_instant,\n    home_brew_bean2cup,\n    home_brew_cold_brew,\n    home_brew_cometeer,\n    home_brew_other,\n    favorite_coffee_drink,\n    roast_preference,\n    expertise,\n    favorite_abcd\n  ) |>\n  drop_na() |>\n  mutate(\n    gender = case_when(\n      gender == \"Female\" ~ \"Female\",\n      gender == \"Male\" ~ \"Male\",\n      TRUE ~ \"Other\"\n    ),\n    age = case_when(\n      age == \"<18 years old\" ~ \"under24\",\n      age == \"18-24 years old\" ~ \"under24\",\n      age == \"45-54 years old\" ~ \"over44\",\n      age == \"55-64 years old\" ~ \"over44\",\n      age == \">65 years old\" ~ \"over44\",\n      TRUE ~ age\n    ),\n    cup_per_day = case_when(\n      cup_per_day == \"More than 4\" ~ \"three_or_more\",\n      cup_per_day == \"4\" ~ \"three_or_more\",\n      cup_per_day == \"3\" ~ \"three_or_more\",\n      cup_per_day == \"Less than 1\" ~ \"one_or_less\",\n      cup_per_day == \"1\" ~ \"one_or_less\",\n      TRUE ~ cup_per_day\n    ),\n    favorite_coffee_drink = case_when(\n      favorite_coffee_drink == \"Regular drip coffee\" ~ \"drip\",\n      favorite_coffee_drink == \"Pourover\" ~ \"pourover\",\n      favorite_coffee_drink == \"Other\" ~ \"other\",\n      favorite_coffee_drink == \"Mocha\" ~ \"other\",\n      favorite_coffee_drink == \"Latte\" ~ \"latte\",\n      favorite_coffee_drink == \"Iced coffee\" ~ \"other\",\n      favorite_coffee_drink == \"Espresso\" ~ \"espresso\",\n      favorite_coffee_drink == \"Cortado\" ~ \"cortado\",\n      favorite_coffee_drink == \"Cold brew\" ~ \"other\",\n      favorite_coffee_drink == \"Cappuccino\" ~ \"cappuccino\",\n      favorite_coffee_drink == \"Blended drink (e.g. Frappuccino)\" ~ \"other\",\n      favorite_coffee_drink == \"Americano\" ~ \"americano\"\n    ),\n    roast_preference = case_when(\n      roast_preference == \"Nordic\" ~ \"light\",\n      roast_preference == \"Medium\" ~ \"medium\",\n      roast_preference == \"Light\" ~ \"light\",\n      roast_preference == \"Italian\" ~ \"dark\",\n      roast_preference == \"French\" ~ \"dark\",\n      roast_preference == \"Dark\" ~ \"dark\",\n      roast_preference == \"Blonde\" ~ \"light\",\n    )\n  )\n\nid <- nona$submission_id\n\nnona <- nona |>\n  select(\n    -submission_id\n  )\n\nnona_allcat <- nona  \n```\n:::\n\n\n# Dummy-code Some Variables\n\n\n::: {.cell}\n\n```{.r .cell-code}\npsych::dummy.code(nona$gender) |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     Male Female Other\n[1,]    1      0     0\n[2,]    1      0     0\n[3,]    1      0     0\n[4,]    1      0     0\n[5,]    1      0     0\n[6,]    1      0     0\n```\n\n\n:::\n\n```{.r .cell-code}\nnona$male <- psych::dummy.code(nona$gender)[, 1]\nnona$female <- psych::dummy.code(nona$gender)[, 2]\nnona$gen_other <- psych::dummy.code(nona$gender)[, 3]\n\n# age\npsych::dummy.code(nona$age) |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     25-34 years old 35-44 years old over44 under24\n[1,]               0               0      1       0\n[2,]               1               0      0       0\n[3,]               0               1      0       0\n[4,]               0               0      1       0\n[5,]               0               1      0       0\n[6,]               0               0      1       0\n```\n\n\n:::\n\n```{.r .cell-code}\nnona$twenty534 <- psych::dummy.code(nona$age)[, 1]\nnona$thirty544 <- psych::dummy.code(nona$age)[, 2]\nnona$over44 <- psych::dummy.code(nona$age)[, 3]\nnona$under24 <- psych::dummy.code(nona$age)[, 4]\n\n# cup_per_day\npsych::dummy.code(nona$cup_per_day) |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     2 one_or_less three_or_more\n[1,] 1           0             0\n[2,] 1           0             0\n[3,] 0           1             0\n[4,] 0           0             1\n[5,] 1           0             0\n[6,] 1           0             0\n```\n\n\n:::\n\n```{.r .cell-code}\nnona$cup_2 <- psych::dummy.code(nona$cup_per_day)[, 1]\nnona$cup_1orless <- psych::dummy.code(nona$cup_per_day)[, 2]\nnona$cup_3ormore <- psych::dummy.code(nona$cup_per_day)[, 3]\n\n# favorite_coffee_drink\npsych::dummy.code(nona$favorite_coffee_drink) |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     pourover latte other drip cappuccino espresso cortado americano\n[1,]        0     0     0    1          0        0       0         0\n[2,]        1     0     0    0          0        0       0         0\n[3,]        0     0     1    0          0        0       0         0\n[4,]        1     0     0    0          0        0       0         0\n[5,]        0     0     0    0          1        0       0         0\n[6,]        1     0     0    0          0        0       0         0\n```\n\n\n:::\n\n```{.r .cell-code}\nnona$pourover <- psych::dummy.code(nona$favorite_coffee_drink)[, 1]\nnona$latte <- psych::dummy.code(nona$favorite_coffee_drink)[, 2]\nnona$other <- psych::dummy.code(nona$favorite_coffee_drink)[, 3]\nnona$drip <- psych::dummy.code(nona$favorite_coffee_drink)[, 4]\nnona$cappuccino <- psych::dummy.code(nona$favorite_coffee_drink)[, 5]\nnona$espresso <- psych::dummy.code(nona$favorite_coffee_drink)[, 6]\nnona$cortado <- psych::dummy.code(nona$favorite_coffee_drink)[, 7]\nnona$americano <- psych::dummy.code(nona$favorite_coffee_drink)[, 8]\n\n# roast_preference\npsych::dummy.code(nona$roast_preference) |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     light medium dark\n[1,]     1      0    0\n[2,]     1      0    0\n[3,]     1      0    0\n[4,]     0      0    1\n[5,]     1      0    0\n[6,]     1      0    0\n```\n\n\n:::\n\n```{.r .cell-code}\nnona$roast_light <- psych::dummy.code(nona$roast_preference)[, 1]\nnona$roast_medium <- psych::dummy.code(nona$roast_preference)[, 2]\nnona$roast_dark <- psych::dummy.code(nona$roast_preference)[, 3]\n\n# expertise          \npsych::dummy.code(nona$expertise) |> head()\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n     7 6 5 8 4 3 2 1 9 10\n[1,] 0 0 0 1 0 0 0 0 0  0\n[2,] 0 0 0 0 0 0 0 0 0  1\n[3,] 0 1 0 0 0 0 0 0 0  0\n[4,] 1 0 0 0 0 0 0 0 0  0\n[5,] 0 0 0 0 1 0 0 0 0  0\n[6,] 0 0 0 1 0 0 0 0 0  0\n```\n\n\n:::\n\n```{.r .cell-code}\nnona$expert7 <- psych::dummy.code(nona$expertise)[, 1]\nnona$expert6 <- psych::dummy.code(nona$expertise)[, 2]\nnona$expert5 <- psych::dummy.code(nona$expertise)[, 3]\nnona$expert8 <- psych::dummy.code(nona$expertise)[, 4]\nnona$expert4 <- psych::dummy.code(nona$expertise)[, 5]\nnona$expert3 <- psych::dummy.code(nona$expertise)[, 6]\nnona$expert2 <- psych::dummy.code(nona$expertise)[, 7]\nnona$expert1 <- psych::dummy.code(nona$expertise)[, 8]\nnona$expert9 <- psych::dummy.code(nona$expertise)[, 9]\nnona$expert10 <- psych::dummy.code(nona$expertise)[, 10]\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nnona <- nona |>\n  select(\n    home_brew_pour_over:home_brew_other,\n    favorite_abcd:expert10\n  )\n\n# remove all the reference groups\nnona_noref <- nona |>\n  select(\n    -c(\n      male,\n      twenty534,\n      cup_2,\n      home_brew_pour_over,\n      pourover,\n      roast_medium,\n      expert5\n    )\n  )\n```\n:::\n\n\n## Using Stan\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncolnames(nona_allcat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"gender\"                 \"age\"                    \"cup_per_day\"           \n [4] \"home_brew_pour_over\"    \"home_brew_french_press\" \"home_brew_espresso\"    \n [7] \"home_brew_mr_coffee\"    \"home_brew_pods\"         \"home_brew_instant\"     \n[10] \"home_brew_bean2cup\"     \"home_brew_cold_brew\"    \"home_brew_cometeer\"    \n[13] \"home_brew_other\"        \"favorite_coffee_drink\"  \"roast_preference\"      \n[16] \"expertise\"              \"favorite_abcd\"         \n```\n\n\n:::\n\n```{.r .cell-code}\nglimpse(nona_allcat)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 3,245\nColumns: 17\n$ gender                 <chr> \"Male\", \"Male\", \"Male\", \"Male\", \"Male\", \"Male\",…\n$ age                    <chr> \"over44\", \"25-34 years old\", \"35-44 years old\",…\n$ cup_per_day            <chr> \"2\", \"2\", \"one_or_less\", \"three_or_more\", \"2\", …\n$ home_brew_pour_over    <dbl> 1, 1, 1, 1, 0, 1, 0, 0, 1, 0, 1, 0, 1, 0, 1, 1,…\n$ home_brew_french_press <dbl> 1, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 1, 0, 0, 0,…\n$ home_brew_espresso     <dbl> 1, 1, 0, 0, 1, 0, 0, 0, 1, 1, 1, 0, 0, 0, 1, 1,…\n$ home_brew_mr_coffee    <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0,…\n$ home_brew_pods         <dbl> 0, 0, 0, 1, 1, 0, 0, 0, 0, 0, 0, 0, 1, 1, 0, 0,…\n$ home_brew_instant      <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ home_brew_bean2cup     <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 1,…\n$ home_brew_cold_brew    <dbl> 0, 0, 0, 0, 0, 0, 0, 0, 1, 0, 1, 0, 1, 0, 0, 0,…\n$ home_brew_cometeer     <dbl> 0, 0, 0, 0, 0, 1, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,…\n$ home_brew_other        <dbl> 0, 0, 0, 0, 0, 0, 1, 1, 0, 0, 0, 1, 0, 1, 0, 0,…\n$ favorite_coffee_drink  <chr> \"drip\", \"pourover\", \"other\", \"pourover\", \"cappu…\n$ roast_preference       <chr> \"light\", \"light\", \"light\", \"dark\", \"light\", \"li…\n$ expertise              <dbl> 8, 10, 6, 7, 4, 8, 2, 7, 8, 7, 7, 6, 8, 6, 8, 8…\n$ favorite_abcd          <fct> Coffee B, Coffee A, Coffee D, Coffee A, Coffee …\n```\n\n\n:::\n\n```{.r .cell-code}\ncolnames(nona_noref)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"home_brew_french_press\" \"home_brew_espresso\"     \"home_brew_mr_coffee\"   \n [4] \"home_brew_pods\"         \"home_brew_instant\"      \"home_brew_bean2cup\"    \n [7] \"home_brew_cold_brew\"    \"home_brew_cometeer\"     \"home_brew_other\"       \n[10] \"favorite_abcd\"          \"female\"                 \"gen_other\"             \n[13] \"thirty544\"              \"over44\"                 \"under24\"               \n[16] \"cup_1orless\"            \"cup_3ormore\"            \"latte\"                 \n[19] \"other\"                  \"drip\"                   \"cappuccino\"            \n[22] \"espresso\"               \"cortado\"                \"americano\"             \n[25] \"roast_light\"            \"roast_dark\"             \"expert7\"               \n[28] \"expert6\"                \"expert8\"                \"expert4\"               \n[31] \"expert3\"                \"expert2\"                \"expert1\"               \n[34] \"expert9\"                \"expert10\"              \n```\n\n\n:::\n\n```{.r .cell-code}\nnona_allcat <- nona_allcat |>\n  mutate(\n    gender = case_when(\n      gender == \"Male\" ~ 1,\n      gender == \"Female\" ~ 2,\n      gender == \"Other\" ~ 3\n    ),\n    age = case_when(\n      age == \"under24\" ~ 1,\n      age == \"25-34 years old\" ~ 2,\n      age == \"35-44 years old\" ~ 3,\n      age == \"over44\" ~ 4\n    ),\n    cup_per_day = case_when(\n      cup_per_day == \"one_or_less\" ~ 1,\n      cup_per_day == \"2\" ~ 2,\n      cup_per_day == \"three_or_more\" ~ 3\n    ),\n    favorite_coffee_drink = case_when(\n      favorite_coffee_drink == \"pourover\" ~ 1,\n      favorite_coffee_drink == \"latte\" ~ 2,\n      favorite_coffee_drink == \"other\" ~ 3,\n      favorite_coffee_drink == \"drip\" ~ 4,\n      favorite_coffee_drink == \"cappuccino\" ~ 5,\n      favorite_coffee_drink == \"espresso\" ~ 6,\n      favorite_coffee_drink == \"cortado\" ~ 7,\n      favorite_coffee_drink == \"americano\" ~ 8\n    ),\n    roast_preference = case_when(\n      roast_preference == \"light\" ~ 1,\n      roast_preference == \"medium\" ~ 2,\n      roast_preference == \"dark\" ~ 3\n    ),\n    expertise = case_when(\n      expertise == \"1\" ~ 1,\n      expertise == \"2\" ~ 2,\n      expertise == \"3\" ~ 3,\n      expertise == \"4\" ~ 4,\n      expertise == \"5\" ~ 5,\n      expertise == \"6\" ~ 6,\n      expertise == \"7\" ~ 7,\n      expertise == \"8\" ~ 8,\n      expertise == \"9\" ~ 9,\n      expertise == \"10\" ~ 10\n    ),\n    favorite_abcd = case_when(\n      favorite_abcd == \"Coffee A\" ~ 1,\n      favorite_abcd == \"Coffee B\" ~ 2,\n      favorite_abcd == \"Coffee C\" ~ 3,\n      favorite_abcd == \"Coffee D\" ~ 4\n    )\n  )\n\n\nnona_noref_recode <- nona_noref |>\n  mutate(\n    across(\n      -favorite_abcd,\n      ~case_when(\n        .x == 0 ~ -1,\n        TRUE ~ .x\n      )\n    )\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstan_allcat_list <- list(\n  J = nrow(nona_allcat[,-1]),\n  y_cat = count(nona_allcat, favorite_abcd) |> nrow(),\n  roast_preference_cat = count(nona_allcat, roast_preference) |> nrow(),\n  expert_cat = count(nona_allcat, expertise) |> nrow(),\n  cup_per_day_cat = count(nona_allcat, cup_per_day) |> nrow(),\n  favorite_coffee_drink_cat = count(nona_allcat, favorite_coffee_drink) |> nrow(),\n  gender_cat = count(nona_allcat, gender) |> nrow(),\n  age_cat = count(nona_allcat, age) |> nrow(),\n\n  Y = nona_allcat$favorite_abcd,\n  roast_preference = nona_allcat$roast_preference,\n  expert = nona_allcat$expertise,\n  favorite_coffee_drink = nona_allcat$favorite_coffee_drink,\n  cup_per_day = nona_allcat$cup_per_day,\n  home_brew_pourover = nona_allcat$home_brew_pour_over,\n  home_brew_french_press = nona_allcat$home_brew_french_press,\n  home_brew_espresso = nona_allcat$home_brew_espresso,\n  home_brew_mr_coffee = nona_allcat$home_brew_mr_coffee,\n  home_brew_pods = nona_allcat$home_brew_pods,\n  home_brew_instant = nona_allcat$home_brew_instant,\n  home_brew_bean2cup = nona_allcat$home_brew_bean2cup,\n  home_brew_cold_brew = nona_allcat$home_brew_cold_brew,\n  home_brew_cometeer = nona_allcat$home_brew_cometeer,\n  home_brew_other = nona_allcat$home_brew_other,\n  age = nona_allcat$age,\n  gender = nona_allcat$gender  \n)\n\nglimpse(stan_allcat_list)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nList of 25\n $ J                        : int 3245\n $ y_cat                    : int 4\n $ roast_preference_cat     : int 3\n $ expert_cat               : int 10\n $ cup_per_day_cat          : int 3\n $ favorite_coffee_drink_cat: int 8\n $ gender_cat               : int 3\n $ age_cat                  : int 4\n $ Y                        : num [1:3245] 2 1 4 1 1 4 4 4 3 2 ...\n $ roast_preference         : num [1:3245] 1 1 1 3 1 1 2 1 2 3 ...\n $ expert                   : num [1:3245] 8 10 6 7 4 8 2 7 8 7 ...\n $ favorite_coffee_drink    : num [1:3245] 4 1 3 1 5 1 2 8 6 7 ...\n $ cup_per_day              : num [1:3245] 2 2 1 3 2 2 2 1 3 2 ...\n $ home_brew_pourover       : num [1:3245] 1 1 1 1 0 1 0 0 1 0 ...\n $ home_brew_french_press   : num [1:3245] 1 0 0 1 0 0 0 0 1 0 ...\n $ home_brew_espresso       : num [1:3245] 1 1 0 0 1 0 0 0 1 1 ...\n $ home_brew_mr_coffee      : num [1:3245] 0 0 0 0 0 0 0 0 0 0 ...\n $ home_brew_pods           : num [1:3245] 0 0 0 1 1 0 0 0 0 0 ...\n $ home_brew_instant        : num [1:3245] 0 0 0 0 0 0 0 0 0 0 ...\n $ home_brew_bean2cup       : num [1:3245] 0 0 0 0 0 0 0 0 0 0 ...\n $ home_brew_cold_brew      : num [1:3245] 0 0 0 0 0 0 0 0 1 0 ...\n $ home_brew_cometeer       : num [1:3245] 0 0 0 0 0 1 0 0 0 0 ...\n $ home_brew_other          : num [1:3245] 0 0 0 0 0 0 1 1 0 0 ...\n $ age                      : num [1:3245] 4 2 3 4 3 4 3 3 3 2 ...\n $ gender                   : num [1:3245] 1 1 1 1 1 1 1 2 1 1 ...\n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nstan_list <- list(\n  J = nrow(nona_noref_recode[,-1]),\n  I = ncol(nona_noref_recode[,-1]),\n  K = count(nona_noref_recode, favorite_abcd) |> nrow(),\n\n  female = nona_noref_recode$female,\n  gen_other = nona_noref_recode$gen_other,\n\n  thirty544 = nona_noref_recode$thirty544,\n  over44 = nona_noref_recode$over44,\n  under24 = nona_noref_recode$under24,\n\n\n  home_brew_french_press = nona_noref_recode$home_brew_french_press,\n  home_brew_espresso = nona_noref_recode$home_brew_espresso,\n  home_brew_mr_coffee = nona_noref_recode$home_brew_mr_coffee,\n  home_brew_pods = nona_noref_recode$home_brew_pods,\n  home_brew_instant = nona_noref_recode$home_brew_instant,\n  home_brew_bean2cup = nona_noref_recode$home_brew_bean2cup,\n  home_brew_cold_brew = nona_noref_recode$home_brew_cold_brew,\n  home_brew_cometeer = nona_noref_recode$home_brew_cometeer,\n  home_brew_other = nona_noref_recode$home_brew_other,\n  \n  latte = nona_noref_recode$latte,\n  otherdrink = nona_noref_recode$other,\n  drip = nona_noref_recode$drip,\n  cappuccino = nona_noref_recode$cappuccino,\n  espresso = nona_noref_recode$espresso,\n  cortado = nona_noref_recode$cortado,\n\n  cup_1orless = nona_noref_recode$cup_1orless,\n  cup_3ormore = nona_noref_recode$cup_3ormore,\n\n\n  americano = nona_noref_recode$americano,         \n  roast_light = nona_noref_recode$roast_light,\n  roast_dark = nona_noref_recode$roast_dark,\n\n  expert7 = nona_noref_recode$expert7,\n  expert6 = nona_noref_recode$expert6,\n  expert8 = nona_noref_recode$expert8,\n  expert4 = nona_noref_recode$expert4,\n  expert3 = nona_noref_recode$expert3,\n  expert2 = nona_noref_recode$expert2,\n  expert1 = nona_noref_recode$expert1,\n  expert9 = nona_noref_recode$expert9,\n  expert10 = nona_noref_recode$expert10,\n\n  Y = nona_noref_recode$favorite_abcd\n)\n\n# glimpse(stan_list)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(12345)\nmod <- cmdstan_model(here::here(\"random_scripts\", \"updated_stan_model.stan\"))\n\n# mod$format(\n#   canonicalize = list(\"deprecations\"),\n#   overwrite_file = TRUE,\n#   backup = FALSE\n# )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfit <- mod$sample(\n  data = stan_list,\n  seed = 12345,\n  iter_warmup = 2000,\n  iter_sampling = 2000,\n  # adapt_delta = .90,\n  chains = 4,\n  # step_size = .01,\n  parallel_chains = 8\n)\n\nsaveRDS(fit, \"coffee_tasting_bayes_net.RDS\")\n\n# fit <- read_rds(here::here(\"random_data\", \"coffee_tasting_bayes_net.RDS\"))\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nfit$output()[[1]]\n\nfit$diagnostic_summary()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbn_measure <- summarize_draws(fit$draws(), default_summary_measures())\nbn_converge <- summarize_draws(fit$draws(), default_convergence_measures())\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbn_converge |>\n  arrange(rhat) |>\n  mutate(\n    across(\n      -variable,\n      ~round(.x, 2)\n    )\n  ) |>\n  reactable(\n    filterable = TRUE,\n    searchable = TRUE\n  )\n\nbn_measure |>\n  filter(\n    str_detect(\n      variable,\n      \"theta\"\n    )\n  ) |> \n  mutate(\n    across(\n      -variable,\n      ~round(.x, 2)\n    )\n  ) |>\n  select(\n    variable,\n    mean,\n    sd\n  ) |>\n  reactable(\n    filterable = TRUE,\n    searchable = TRUE\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nbn_measure |>\n  filter(\n    str_detect(\n      variable,\n      \"predictors\"\n    )\n  )\n\nbn_measure |>\n  filter(\n    str_detect(\n      variable,\n      \"^a_\"\n    ) |\n    str_detect(\n      variable,\n      \"^b_\"\n    )\n  ) |> \n  mutate(\n    across(\n      -variable,\n      ~exp(.x)\n    ),\n    across(\n      -variable,\n      ~round(.x, 2)\n    )\n  ) |>\n  select(\n    variable,\n    mean,\n    sd\n  ) |>\n  reactable(\n    filterable = TRUE,\n    searchable = TRUE\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nset.seed(12345)\nmod <- cmdstan_model(here::here(\"random_scripts\", \"all_category_model.stan\"))\n\nfit <- mod$sample(\n  data = stan_allcat_list,\n  seed = 12345,\n  iter_warmup = 1000, #2000\n  iter_sampling = 1000, #2000\n  # adapt_delta = .90,\n  chains = 4,\n  # step_size = .01,\n  parallel_chains = 8\n)\n\nfit$diagnostic_summary()\n\n\n\nbn_converge <- summarize_draws(fit$draws(), default_convergence_measures())\n\nbn_converge |>\n  arrange(rhat) |>\n  mutate(\n    across(\n      -variable,\n      ~round(.x, 2)\n    )\n  ) |>\n  reactable(\n    filterable = TRUE,\n    searchable = TRUE\n  )\n\nbn_measure <- summarize_draws(fit$draws(), default_summary_measures())\n\nbn_measure |>\n  filter(\n    str_detect(\n      variable,\n      \"^a_\"\n    ) |\n    str_detect(\n      variable,\n      \"^b_\"\n    ) |\n    str_detect(\n      variable,\n      \"log_lik\"\n    )\n  ) |>\n  select(\n    variable,\n    log_odds = mean,\n    sd\n  ) |>\n  mutate(\n    prob_use = plogis(log_odds),\n    prob_notuse = 1 - prob_use,\n    #prob = exp(log_odds)/exp(1 + log_odds),\n    across(\n      -variable,\n      ~round(.x, 2)\n    )\n  )  |>\n  reactable(\n    filterable = TRUE,\n    searchable = TRUE\n  )\n```\n:::\n\n\nInterpretations for select parameters\n\nThe alpha parameter for predicting participants' favorite coffee showed that participants who prefer medium roasted coffee and labeled themselves as a 5 on expertise had 1.14 times greater odds of enjoying coffee C than not enjoying it.\n\nalpha = compared to zero\n\nFor example, b_roast_light_yb_roast_light_y is the change in log-odds for a given category when the roast level is light. Similarly, b_expert1_yb_expert1_y to b_expert10_yb_expert10_y represent the effects of being in each expert level on the log-odds of a particular category, again without any specific reference category. \n\n\n::: {.cell}\n\n```{.r .cell-code}\nalphas <- c(\n\"a_latte\",\n\"a_otherdrink\",\n\"a_drip\",\n\"a_cappuccino\",\n\"a_espresso\",\n\"a_cortado\",\n\"a_americano\",\n\"a_home_frenchpress\",\n\"a_home_espresso\",\n\"a_home_mrcoffee\",\n\"a_home_pods\",\n\"a_home_instant\",\n\"a_home_bean2cup\",\n\"a_home_coldbrew\",\n\"a_home_cometeer\",\n\"a_home_other\",\n\"a_cup_1orless\",\n\"a_cup_3ormore\",\n\"a_roast_light\",\n\"a_roast_dark\",\n\"a_expert1\",\n\"a_expert2\",\n\"a_expert3\",\n\"a_expert4\",\n\"a_expert6\",\n\"a_expert7\",\n\"a_expert8\",\n\"a_expert9\",\n\"a_expert10\",\n\"a_y[1]\",\n\"a_y[2]\", \n\"a_y[3]\",\n\"a_y[4]\"\n)\n\nb_latte <- c(\n  \"b_female_latte\",\n  \"b_gen_other_latte\",\n  \"b_thirty544_latte\",\n  \"b_over44_latte\",\n  \"b_under24_latte\",\n  \"b_home_frenchpress_latte\",\n  \"b_home_espresso_latte\",\n  \"b_home_mrcoffee_latte\",\n  \"b_home_pods_latte\",\n  \"b_home_instant_latte\",\n  \"b_home_bean2cup_latte\",\n  \"b_home_coldbrew_latte\",\n  \"b_home_cometeer_latte\",\n  \"b_home_other_latte\"\n)\n\nalphas <- fit$draws(alphas) |> as_draws_matrix()\nbeta_var_latte <- fit$draws(b_latte) |> as_draws_matrix()\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmcmc_trace(alphas)\nmcmc_trace(beta_var_latte)\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmcmc_areas(alphas)\nmcmc_areas(beta_var_latte)\n```\n:::",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}